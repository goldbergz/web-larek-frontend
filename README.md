<!-- Здравствуйте! Прошу принять первую часть проекта, предполагающую создание документации, и проставить за нее баллы по рубриткатору. Согласно ТЗ, на данном этапе проверяется только она - это согласовано с менеджером сопровождения. 

UPD: Уточнила еще раз у менеджера. За данную работу необходимо выставить баллы и полностью принять работу.
"Мы с ревьюерами дополнительно проговорили, что работу они принимать должны. У нас это отдельный проект и за него обязательно баллы должны проставляться" -  слова менеджера по сопровождению
-->

# Проектная работа "Веб-ларек"

Веб-ларек - это современный интернет-магазин, специализирующийся на товарах для веб-разработчиков. Проект представляет собой полнофункциональное SPA-приложение с каталогом товаров, корзиной покупок и многошаговым оформлением заказа.

Ключевая особенность проекта — чёткое разделение **View-компонентов**, **моделей данных**, **контроллеров** и **событийной системы**, что делает код прозрачным, тестируемым и легко расширяемым.


#### Стек: HTML, SCSS, TS, Webpack

#### Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/types/ — папка с типизацией компанентов
- src/types/base/ — папка с базовыми типами и основными сущностями
- src/types/model/ — папка с типизацией компонентов модели проекта
- src/types/view/ — папка с типизацией компонентов отображения проекта

#### Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура проекта
Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.

Проект реализован по архитектурному подходу MVP + Event Bus, где:

- Model — классы хранения состояния
- View — классы отображения
- Presenter — index.ts и связанные контроллеры
- Service (API) — классы для HTTP-запросов
- Events — событийная система для связи компонентов

## Базовые типы и классы (src/types/base/)
### Класс ```Api```
**Назначение:**

Базовый HTTP-клиент, инкапсулирующий логику сетевых запросов и обработку ответов сервера.
Используется как родительский класс для всех сервисов, работающих с API.

**Конструктор**

```constructor(baseUrl: string, options: RequestInit = {})```

**Параметры конструктора:**
- baseUrl: string — базовый URL сервера
- options: RequestInit — глобальные опции для всех запросов (заголовки, credentials и т.д.)

**Поля**
- baseUrl: string
- options: RequestInit

**Методы**
- ```get<T>(uri: string): Promise<T>``` — GET-запрос
- ```post<T>(uri: string, data: unknown, method?: ApiPostMethods): Promise<T>``` - Выполняет POST / PUT / DELETE запросы в зависимости от метода
- ```handleResponse<T>(response: Response): Promise<T>``` - Проверяет валидность ответа сервера и преобразует его в JSON. Выбрасывает ошибку при некорректном статусе ответа

**Перечисление ```ApiPostMethods```**

Используется в методе post базового класса Api.

POST | PUT | DELETE

Позволяет избежать использования строковых литералов для HTTP-методов.

### ```ErrorState```
**Назначение:**
Тип состояния ошибки, используемый в моделях данных и презентере.

```
{
  error: string;
}
```

**Используется:**
- для хранения текста ошибки
- для отображения ошибок во view

### События приложения (AppEvents.ts)
```AppEvents``` - перечисление всех событий, которыми общаются:
- модели
- view-компоненты
- контроллер
- модальные окна

Также обеспечивает слабую связанность между частями приложения.

Товар:

- PRODUCTS_LOADED - событие загрузки товаров с сервера.
- PRODUCT_SELECTED - событие, отображающее, что товар выбран и открыта модалка этого товара.
- PRODUCT_ADD_TO_BASKET - событие добавление товара в корзину.
- PRODUCT_REMOVE_FROM_BASKET - событие удаление товара из корзины.

Корзина:
- BASKET_OPEN - событие, отображающее, что модалка корзины открыта.

Заказ:
- ORDER_START - начало оформления заказа.
- ORDER_PAYMENT_SET - шаг заполнения платежной информации в заказе (1 шаг).
- ORDER_CONTACTS_SET - шаг заполнения контактной информации в заказе (2 шаг).
- ORDER_SUCCESS - отображение модлаки о успешном оформлении заказа.
- ORDER_STEP_CHANGE - переключает модальные окна шагов оплаты.

Модалки:
- MODAL_OPEN - открывает конкретное модальное окно.
- MODAL_CLOSE - закрывает конкретное модальное окно


```ModalData``` - тип передаваемых данных при открытии любой модалки.

Параметры открываемой модалки:
- ```type: "product" | "basket" | "order" | "success"``` - какой модалке открыться (в зависимости от события).
- ```data?: unknown``` - что показать (товар, корзина, заказ).

```OrderData``` - используется при переходах между шагами оформления заказа.

Содержит:
- текущий объект заказа
- шаг: payment, contacts, success

Позволяет:
- переключать UI
- валидировать шаги

### Типы данных доменной модели (DataTypes.ts)
```IProduct``` - описание товара, приходящего с API и отображаемого пользователю.

Используется в:
- каталоге
- карточках товара
- модалке товара
- корзине

Товар:
- id - уникальный идентификатор для поиска и действий
- title - имя товара
- description - подробное описание в модалке
- image - ссылка на изображение
- category - нужен для отображения категории товара
- price - отображение суммы, расчёт итоговой цены в корзине

```IBasketItem``` - единица товара в корзине(для удобного разделения товара в корзине от его отображения на главной старнице).

Элемент корзины:
- product: IProduct

```PaymentSettings``` - данные первого шага оформления заказа.

Шаг 1 — способ оплаты:
- ```paymentType: "online" | "upon receipt"``` - выбранный способ оплаты
- ```address: string``` - адрес доставки

```PaymentContacts``` - данные второго шага оформления.

Шаг 2 — контакты:
- email: string
- phone: string

Используется:
- для валидации перед оплатой
- в createOrder()

```OrderSettings``` - объединение данных двух шагов в единый объект.

```typescript
{
  paymentSettings: PaymentSettings;
  paymentContacts: PaymentContacts;
}
```

```Order``` - полное описание заказа, которое уходит на сервер.

Общий объект заказа:
- items - список товаров
- totalPrice - итоговая цена
- OrderSettings - данные обоих шагов оформления


## Базовые интерфейсы моделей (Model.ts)
```IModel<T>``` - базовый интерфейс реактивной модели, которую можно слушать.

Используется всеми моделями:
- ProductModel
- BasketModel
- OrderModel

Методы:
- getState(): T — возвращает текущее состояние модели.
- setState(newState: T): void — устанавливает новое состояние и вызывает всех слушателей.
- addChangeListener(cb) — позволяет view подписаться на изменения модели.
- removeChangeListener(cb) — прекращает отслеживать модель.
- emitChange(): void - механизм уведомления подписчиков, что состояние изменилось.


## Классы моделей данных
### Класс ```ProductModel```

**Назначение:**
Хранит каталог товаров и предоставляет доступ к данным.

**Конструктор**

```constructor()```

**Поля**
- products: IProduct[] — список товаров

**Методы**
- ```setProducts(products: IProduct[]): void``` — устанавливает каталог
- ```getProductById(id: string): IProduct | undefined``` - предоставляет доступ к товарам по ID

### Класс ```BasketModel```

**Назначение:**
Хранит состояние корзины и управляет товарами.

**Конструктор**

```constructor()```

**Поля**
- items: IBasketItem[] - массив товаров
- totalPrice: number - общая стоимость всех отваров в корзине
- totalQuantity: number - общее количество товаров в корзине

**Методы**
- ```addProduct(product: IProduct): void``` - добавляет товары в корзину
- ```removeProduct(productId: string): void``` - удаляет товары из корзины по айди
- ```getTotalPrice(): number``` - вычисляет общую стоимость
- ```getItemCount(): number``` - вычисляет общее количетсво предметов
- ```isEmpty(): boolean``` - проверяет состояние корзины

### Класс ```OrderModel```

**Назначение:**
Хранит данные оформления заказа между шагами.

**Конструктор**

```constructor()```

**Методы**
- ```setStep(step: OrderStep): void``` - задает шаг формления заказа
- ```setPaymentSettings(settings: PaymentSettings): void``` - сохраняет данные первого шага
- ```setContacts(contacts: PaymentContacts): void``` - сохраняет данные второго шага
- ```setItems(items: IBasketItem[]): void``` - сохраняет товары в заказе
- ```getOrderData(): Order```
- ```validatePayment(): boolean``` - проверяет:
  - заполнен ли адрес
  - выбран ли метод оплаты
- ```validateContacts(): boolean``` - проверяет:
  - корректо заполнен email
  - корректо заполнен номер
- ```reset()``` -  сбрасывает данные заказа после успешного оформления
Не отправляет заказ на сервер

## API-сервисы
### Класс ```ApiService extends Api```
**Назначение:**
Сервисный слой для работы с бизнес-данными приложения.

**Конструктор**

```constructor(baseUrl: string, options: RequestInit = {})```

**Параметры конструктора:**
- baseUrl: string — базовый URL сервера
- options: RequestInit — глобальные опции для всех запросов (заголовки, credentials и т.д.)

**Методы**
- ```getProducts(): Promise<IProduct[]>```
- ```getProductById(id: string): Promise<IProduct>```
- ```createOrder(order: Order): Promise<OrderResponse>```

Используется исключительно в **презентере**
Модели не знают о существовании этого класса

## Элементы представления (View)
### Базовый класс Component
**Назначение:**

Общий базовый класс для всех UI-компонентов приложения. Инкапсулирует работу с DOM-элементом и повторяющиеся операции.

**Конструктор**

```constructor(element: HTMLElement)```

**Поля**
- element: HTMLElement — корневой DOM-элемент компонента

**Методы**
- ```show(): void``` — показывает элемент
- ```hide(): void``` — скрывает элемент
- ```setText(text: string): void``` — устанавливает текстовое содержимое
- ```setDisabled(disabled: boolean): void``` — включает/выключает элемент
- ```toggleClass(className: string, state: boolean): void``` — управляет CSS-классами

### Базовые интерфейсы представлений

```IView``` - базовый интерфейс для всех UI-компонентов.

- ```element: HTMLElement``` - DOM-узел
- ```render(): HTMLElement``` - обновляет внешний вид view

```IDataView<T>``` - универсальный интерфейс для рендеринга данных модели.

- ```update(data: Partial<T>): HTMLElement``` - обновляет переданные данные на основе модели (товар, корзина, заказ)

Используется для карточек, списков, модалок.

```IModal``` - общий интерфейс всех модальных окон.

Свойства:
- closeButton: HTMLButtonElement - кнопка закрытия модалки, которая есть во всех окнах
- content?: HTMLElement - контент модалки

Методы:
- open() - показывает модалку
- close() - скрывает модалку
- isOpen(): boolean - проверяет состояние

```IList<T>``` - отображение массивов данных. Переиспользуемый список для каталога и корзины.

Свойства:
-items: T[] - элементы списка

Методы:
- setItems(items: T[]) - задать новые элементы
- getItems(): T[] - получить текущие элементы
- onItemClick?(cb) - обработка клика по элементу (открытие модалки в каталоге)

### Конкретные классы представления
```ProductListView```
- принимает DOM-элемент в конструкторе
- подписывается на клики
- рендерит список товаров

**Конструктор**

```constructor(container: HTMLElement)```

**Параметры конструктора**
- container: HTMLElement — DOM-элемент, в котором отображается каталог

**Методы**
- ```setItems(products: IProduct[]): void``` — рендерит каталог
- ```onProductClick(cb): void``` — обработка клика по товару

```ProductCardView```

**Назначение:**

Отображает отдельный товар в каталоге.

**Конструктор**

```constructor(container: HTMLElement, product: IProduct)```

**Параметры**
- container: HTMLElement — контейнер списка
- product: IProduct — данные товара

**Методы**
- ```setProduct(product: IProduct): void```

```ProductModalView```

**Назначение:**

Отображает подробную информацию о товаре в модальном окне.

Наследует IDataView<IProduct>.

**Конструктор**

```constructor(modalElement: HTMLElement)```

**Методы**
- ```setProduct(product: IProduct): void``` - показать данные товара в модалке
- ```setInBasket(isInBasket: boolean): void``` - проверка, есть ли товар в корзине, для корректного отображения кнопки "Добавить в корзину"
- ```onAddToBasket(cb): void``` - рекция на клик по кнопке "Добавить в корзину"
- ```onRemoveFromBasket(cb): void``` - рекция на клик по кнопке "Удалить из корзины"

```BasketListView```

**Назначение:**

Отображает список товаров в корзине.

**Конструктор**

```constructor(container: HTMLElement)```

**Параметры конструктора**
- container: HTMLElement — DOM-элемент, в который рендерится список товаров корзины


**Методы**
- ```onRemoveItem(cb): void``` - удалить товар
- ```onUpdateQuantity(cb): void``` - изменение количества

```BasketModalView```

**Назначение:**

Модальное окно корзины. Отображает список товаров, итоговую сумму и кнопку перехода к оформлению заказа.

**Конструктор**

```constructor(modalElement: HTMLElement, basketList: BasketListView)```

**Параметры конструктора**
- modalElement: HTMLElement — корневой DOM-элемент модалки
- basketList: IBasketListView — компонент списка товаров корзины

**Методы**
- ```updateBasket(items: IBasketItem[]): void``` - обновить отображение корзны
- ```updateTotalPrice(price: number): void``` - обновить сумму

```OrderModalView```

**Назначение:**

Отображает пошаговое оформление заказа.

**Конструктор**

```constructor(modalElement: HTMLElement)```

**Методы**
- ```setStep(step: 'payment' | 'contacts' | 'success'): void``` - переключить шаг оформления
- ```setPaymentData(data: PaymentSettings): void``` - заполнить UI шаг 1
- ```setContactsData(data: PaymentContacts): void``` - заполнить UI шаг 2
- ```setSuccessData(total: number, orderId: string): void```
- ```onNextStep(cb): void``` - переход на следующий шаг
- ```onPreviousStep(cb): void``` - назад
- ```onSubmit(cb): void``` - отправка заказа, переход на окно success

### Интерфейсы представлений
#### Layout
```IInteractiveElement``` - для кнопок, интерактивных элементов.

Наследует IView.

Методы:
- setDisabled - запрещает взаимодействие (важно в шагах заказа)
- onClick? - реакция на клик

```IButton```

Расширяет IInteractiveElement.

Методы:
- setText(text) - смена текста кнопки

```IHeader``` - отображения шапки страницы

Методы:
- updateBasketCount - обновление счетчика товаров в корзине в шапке
- onLogoClick? - визуальная реакция на клик по лого
- onBasketClick? - визуальная реакция на клик по корзине

```IPage``` - оборачивает разные страницы приложения.

Методы:
- setContent(content) - заменяет контент страницы

## Взаимодействие всех типов между собой

### Загрузка товаров
1. index.ts → ApiService.getProducts()
2. данные → ProductModel.setProducts
3. событие PRODUCTS_LOADED
4. ProductListView.render

### Оформление заказа
1. BasketModel → товары
2. OrderModel.setPaymentSettings
3. OrderModel.setContacts
4. ApiService.createOrder
5. ORDER_SUCCESS
6. BasketModel.clear

### Просмотр товара
1. Пользователь кликает по карточке товара
2. ProductListView вызывает PRODUCT_SELECTED
3. Презентер получает товар из ProductModel
4. Открывается ProductModalView

### Добавление товара в корзину
1. Пользователь нажимает «Добавить в корзину»
2. ProductModalView генерирует PRODUCT_ADD_TO_BASKET
3. BasketModel.addProduct()
4. Генерируется BASKET_UPDATE
5. Обновляются:
- Header
- BasketModal
- BasketListView